from bs4 import BeautifulSoup
import requests
import html5lib
import csv
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import time

#1
page=1
library=requests.get("https://www.loc.gov/search/?q=cats&sp=1").text
soup=BeautifulSoup(library)
csv_file=open("cat_site.csv","w")
csv_writer=csv.writer(csv_file)
csv_writer.writerow(["Title","Description"])

while page<=5:
    page+=1
    for element in soup.find_all("div", class_="item-description"):
        title=element.span.a.text.strip()
        try:
            desc=element.find("span",class_="item-description-abstract").text.strip()
        except:
            desc="No Description"
        csv_writer.writerow([title,desc])
    soup=BeautifulSoup(requests.get(f"https://www.loc.gov/search/?q=cats&sp={page}").text)
csv_file.close()

#2
csv_file=open("cat_wiki.csv","w")
csv_writer=csv.writer(csv_file)
csv_writer.writerow(["Image Links"])

driver = webdriver.Chrome()
driver.get("https://www.wikipedia.org/")
search=driver.find_element(By.ID, "searchInput")
search.send_keys("cat")
search.send_keys(Keys.RETURN)

for element in driver.find_elements(By.TAG_NAME, "img"):
    link=element.get_attribute("src")
    csv_writer.writerow([link])
driver.quit

#BONUS
'''These lines are allowing us to write in the csv file'''
csv_file=open("conangray_tour.csv","w")
csv_writer=csv.writer(csv_file)
csv_writer.writerow(["Date","Venue", "Location"])

'''These lines are allowing us to open chrome and automate actions on it through Selenium'''
driver = webdriver.Chrome()
driver.get("https://www.conangray.com/")

'''This finds and clicks the "Tour" button'''
WebDriverWait(driver,5).until(
    EC.presence_of_element_located((By.PARTIAL_LINK_TEXT, "Tour"))
)
driver.find_element(By.PARTIAL_LINK_TEXT, "Tour").click()

'''This scrolls until all elements in the "seated-event-row" are visible'''
driver.execute_script("window.scrollTo(0,1500);","")
WebDriverWait(driver, 10).until(EC.visibility_of_all_elements_located((By.CLASS_NAME, "seated-event-row")))

'''This is a for loop finding the dates, venue names, and locations of all the
tour events and writing them in a csv file'''
for element in driver.find_elements(By.CLASS_NAME, "seated-event-row"):
    date=element.find_element(By.CLASS_NAME, "seated-event-date-cell").text
    venue=element.find_element(By.CLASS_NAME, "seated-event-venue-name").text
    location=element.find_element(By.CLASS_NAME, "seated-event-venue-location").text
    csv_writer.writerow([date,venue,location])

'''These lines simply wait 5 seconds, then quit out of chrome'''
csv_file.close()
time.sleep(5)
driver.quit